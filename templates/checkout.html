{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout - Success Driving School{% endblock %}

{% block content %}
<!-- Checkout Hero Section -->
<div class="checkout-hero">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <div class="hero-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h1 class="fw-bold">Checkout</h1>
                <p class="lead">Review your order and complete your purchase</p>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-12">
            <div class="checkout-card card shadow-lg border-0">
                <div class="card-header bg-transparent border-0 text-center py-4">
                    <h4 class="fw-bold text-dark mb-0">Complete Your Order</h4>
                    <p class="text-muted mb-0">Secure checkout for your driving lesson plans</p>
                </div>
                <div class="card-body p-5">
                    <div class="row">
                        <!-- Order Summary Section -->
                        <div class="col-lg-5">
                            <div class="order-summary-section">
                                <h5 class="fw-bold text-dark mb-4">Order Summary</h5>
                                {% for item in cart_items %}
                                <div class="order-item-card mb-3">
                                    <div class="order-item-header">
                                        <div class="plan-icon-checkout">
                                            <i class="fas fa-graduation-cap"></i>
                                        </div>
                                        <div class="plan-details-checkout">
                                            <h6 class="fw-bold text-dark mb-1">{{ item.plan.name }}</h6>
                                            <p class="text-muted mb-2">{{ item.plan.description }}</p>
                                        </div>
                                    </div>
                                    <div class="plan-features-checkout">
                                        <div class="feature-row">
                                            <div class="feature-col">
                                                <div class="feature-badge">
                                                    <i class="fas fa-clock me-1"></i>
                                                    <span>{{ item.plan.hours }}h</span>
                                                </div>
                                            </div>
                                            <div class="feature-col">
                                                <div class="feature-badge">
                                                    <i class="fas fa-star me-1"></i>
                                                    <span>{{ item.plan.credits }} Credits</span>
                                                </div>
                                            </div>
                                            <div class="feature-col">
                                                <div class="price-badge">
                                                    <span>${{ item.plan.price }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}

                            </div>
                        </div>
                        
                        <!-- Payment Form Section -->
                        <div class="col-lg-7">
                            <div class="payment-form-section">
                                <form method="post" id="payment-form">
                                    {% csrf_token %}
                                    <div class="mb-4">
                                        <h5 class="fw-bold text-dark mb-4">Payment Information</h5>
                                        
                                        <!-- Card Number -->
                                        <div class="mb-3">
                                            <label for="card-number" class="form-label">Card Number</label>
                                            <input type="text" class="form-control" id="card-number" placeholder="1234 5678 9012 3456" required>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="expiry-date" class="form-label">Expiry Date</label>
                                                <input type="text" class="form-control" id="expiry-date" placeholder="MM/YY" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="cvv" class="form-label">CVV</label>
                                                <input type="text" class="form-control" id="cvv" placeholder="123" required>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Billing Information -->
                                    <div class="mb-4">
                                        <h5 class="fw-bold text-dark mb-4">Billing Information</h5>
                                        <div class="mb-3">
                                            <label for="billing-name" class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="billing-name" value="{{ user.first_name }} {{ user.last_name }}" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="billing-address" class="form-label">Address</label>
                                            <input type="text" class="form-control" id="billing-address" value="{{ user.student.address }}" required>
                                        </div>
                                    </div>

                                    <!-- Payment Total -->
                                    <div class="payment-total-section mb-4">
                                        <div class="total-breakdown">
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Subtotal:</span>
                                                <span>${{ total_price }}</span>
                                            </div>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Tax:</span>
                                                <span>$0.00</span>
                                            </div>
                                            <hr>
                                            <div class="d-flex justify-content-between fw-bold fs-5">
                                                <span>Total:</span>
                                                <span class="text-success">${{ total_price }}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Payment Buttons -->
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-lock me-2"></i>Complete Payment - ${{ total_price }}
                                        </button>
                                        <a href="{% url 'plan_selection' %}" class="btn btn-outline-secondary">
                                            <i class="fas fa-arrow-left me-2"></i>Back to Plan Selection
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Basic form validation and formatting
document.getElementById('card-number').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
    e.target.value = formattedValue;
});

document.getElementById('expiry-date').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length >= 2) {
        value = value.substring(0, 2) + '/' + value.substring(2, 4);
    }
    e.target.value = value;
});

document.getElementById('cvv').addEventListener('input', function(e) {
    e.target.value = e.target.value.replace(/\D/g, '').substring(0, 3);
});
</script>

<style>
    .checkout-hero {
        background: black;
        color: white;
        padding: 4rem 0 2rem;
        margin-bottom: 2rem;
        border-radius: 0 0 2rem 2rem;
    }
    
    .checkout-hero .hero-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.9;
    }
    
    .checkout-hero h1 {
        font-weight: 700;
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }
    
    .checkout-hero .lead {
        font-size: 1.1rem;
        opacity: 0.9;
    }
    
    .checkout-card {
        border-radius: 1.5rem;
        overflow: hidden;
        transition: transform 0.3s ease;
    }
    
    .checkout-card:hover {
        transform: translateY(-2px);
    }
    
    .order-summary-section {
        background: linear-gradient(135deg, #f8f9ff, #ffffff);
        border-radius: 1rem;
        padding: 2rem;
        height: fit-content;
        border: 1px solid rgba(102, 126, 234, 0.1);
        position: sticky;
        top: 2rem;
    }
    
    .order-item-card {
        background: white;
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        border: 1px solid rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }
    
    .order-item-card:hover {
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        transform: translateY(-1px);
    }
    
    .order-item-header {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
    }
    
    .plan-icon-checkout {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        margin-right: 1rem;
        flex-shrink: 0;
    }
    
    .plan-details-checkout h6 {
        color: #2d3748;
        margin-bottom: 0.25rem;
    }
    
    .feature-row {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }
    
    .feature-col {
        flex: 1;
        min-width: 0;
    }
    
    .feature-badge {
        background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
        color: #1565c0;
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.85rem;
        font-weight: 600;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .price-badge {
        background: linear-gradient(135deg, #11998e, #38ef7d);
        color: white;
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        font-weight: 700;
        text-align: center;
        font-size: 1rem;
    }
    
    .payment-form-section {
        padding: 1rem;
    }
    
    .payment-form-section h5 {
        color: #2d3748;
    }
    
    .form-control {
        border: 2px solid rgba(102, 126, 234, 0.1);
        border-radius: 0.5rem;
        padding: 0.75rem 1rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        border-color: black;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .form-label {
        color: #4a5568;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    .payment-total-section {
        background: linear-gradient(135deg, #f8f9ff, #ffffff);
        border-radius: 0.75rem;
        padding: 1.5rem;
        border: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .total-breakdown {
        font-size: 0.95rem;
    }
    
    .total-breakdown .d-flex {
        margin-bottom: 0.5rem;
    }
    
    .total-breakdown hr {
        margin: 1rem 0;
        border-color: rgba(102, 126, 234, 0.2);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #11998e, #38ef7d);
        border: none;
        border-radius: 0.75rem;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
    }
    
    .btn-success:hover {
        background: linear-gradient(135deg, #0d7377, #2dd4bf);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(17, 153, 142, 0.4);
    }
    
    .btn-outline-secondary {
        border: 2px solid #6c757d;
        border-radius: 0.75rem;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-outline-secondary:hover {
        background: #6c757d;
        border-color: transparent;
        transform: translateY(-1px);
    }
    
    @media (max-width: 768px) {
        .checkout-hero {
            padding: 2rem 0 1rem;
        }
        
        .checkout-hero h1 {
            font-size: 2rem;
        }
        
        .order-summary-section {
            position: static;
            margin-bottom: 2rem;
        }
        
        .order-item-header {
            flex-direction: column;
            text-align: center;
        }
        
        .plan-icon-checkout {
            margin-right: 0;
            margin-bottom: 1rem;
            align-self: center;
        }
        
        .feature-row {
            justify-content: center;
        }
        
        .feature-col {
            flex: 0 0 auto;
        }
    }
</style>

{% endblock %}